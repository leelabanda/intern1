<script>
    CustomComputeBehavior = {

        properties: {
            baseRestPath: {
                type: String,
                value: function () {
                    return CustomWeb.baseRestPath;
                }
            },
            baseWsPath: {
                type: String,
                value: function () {
                    return CustomWeb.baseWsPath;
                }
            },
            localesPath: {
                type: String,
                value: '../../../locales.json'
            }
        },

        /*
         * Strolch functions
         */
        hasQueryPrivilege: function (privilegeValue) {
            return Strolch.hasRole('StrolchAdmin') || Strolch.hasQueryPrivilege(privilegeValue);
        },
        hasSearchPrivilege: function (privilegeValue) {
            return Strolch.hasRole('StrolchAdmin') || Strolch.hasSearchPrivilege(privilegeValue);
        },
        hasServicePrivilege: function (privilegeValue) {
            return Strolch.hasRole('StrolchAdmin') || Strolch.hasServicePrivilege(privilegeValue);
        },
        hasPrivilege: function (privilege, value) {
            return Strolch.hasRole('StrolchAdmin') || Strolch.hasPrivilege(privilege, value);
        },
        hasRole: function (name) {
            return Strolch.hasRole('StrolchAdmin') || Strolch.hasRole(name);
        },
        hasComponent: function (name) {
            return Strolch.hasComponent(name);
        },

        /*
         * Compute functions
         */
        hasMsg: function (value) {
            return Strolch.isNotEmptyString(value) && value !== "-";
        },

        isEqual: function (v1, v2) {
            return Strolch.isEqual(v1, v2);
        },
        stringToArray: function (string) {
            return Strolch.stringToArray(string);
        },
        stringArrayLength: function (string) {
            return Strolch.stringArrayLength(string);
        },
        isDefined: function (arg0) {
            return Strolch.isDefined(arg0);
        },
        isNull: function (arg0) {
            return Strolch.isNull(arg0);
        },
        isNotNull: function (arg0) {
            return Strolch.isNotNull(arg0);
        },
        isNaN: function (arg0) {
            return Strolch.isNaN(arg0);
        },
        equal: function (arg0, arg1) {
            return Strolch.equal(arg0, arg1);
        },
        notEqual: function (arg0, arg1) {
            return Strolch.notEqual(arg0, arg1);
        },
        defined: function (arg0) {
            return Strolch.defined(arg0);
        },
        greater: function (arg0, arg1) {
            return Strolch.greater(arg0, arg1);
        },
        greaterEqual: function (arg0, arg1) {
            return Strolch.greaterEqual(arg0, arg1);
        },
        lesser: function (arg0, arg1) {
            return Strolch.lesser(arg0, arg1);
        },
        lesserEqual: function (arg0, arg1) {
            return Strolch.lesserEqual(arg0, arg1);
        },
        and: function (arg0, arg1) {
            return Strolch.and(arg0, arg1);
        },
        or: function (arg0, arg1) {
            return Strolch.or(arg0, arg1);
        },
        arrayLength: function (array) {
            return Strolch.arrayLength(array);
        },
        arrayFilled: function (array) {
            return Strolch.arrayFilled(array);
        },
        arraySizeLessThan: function (array, size) {
            return Strolch.arraySizeLessThan(array, size);
        },
        arraySizeGreaterThanOrEq: function (array, size) {
            return Strolch.arraySizeGreaterThanOrEq(array, size);
        },
        arrayEquals: function (array1, array2) {
            return Strolch.arrayEquals(array1, array2);
        },
        add: function (arg0, arg1) {
            return Strolch.add(arg0, arg1);
        },
        sub: function (arg0, arg1) {
            return Strolch.sub(arg0, arg1);
        },
        round: function (value) {
            return Strolch.round(value);
        },
        stringEmpty: function () {
            return Strolch.stringEmpty(arguments);
        },
        isEmptyString: function (val) {
            return Strolch.isEmptyString(val);
        },
        isNotEmptyString: function (val) {
            return Strolch.isNotEmptyString(val);
        },

        isChrome: function () {
            return Strolch.isChrome();
        },
        isFirefox: function () {
            return Strolch.isFirefox();
        },
        isIE: function () {
            return Strolch.isIE();
        },
        isEdge: function () {
            return Strolch.isEdge();
        },

        /*
         * Date Time functions
         */
        formatDateTime: function (string) {
            return Strolch.toLocalDateTime(string);
        },

        // gets the clock time as displayed in the UI
        getTimeString: function (datetime) {
            return Strolch.getTimeString(datetime);
        },

        // gets the calendar date as displayed in the UI
        getDateString: function (datetime, addCentury) {
            return Strolch.getDateString(datetime, addCentury);
        },

        // gets the date of a date string from getDateString()
        getDate: function (datetimeString) {
            return Strolch.getDate(datetimeString);
        },

        // gets the clock time of the current time
        getCurrentTimeString: function () {
            return Strolch.getCurrentTimeString();
        },

        toDateTimeNoDelim: function (val) {
            return Strolch.toDateTimeNoDelim(val);
        },

        // gets the calendar date of the current time
        getCurrentDateString: function () {
            return Strolch.getDateString(new Date());
        },

        clearTime: function (date) {
            return Strolch.clearTime(date);
        },
        dateToJson: function (date) {
            return Strolch.dateToJson(date);
        },

        // returns true if a datetime has past
        isPast: function (datetime) {
            return Strolch.isPast(datetime);
        },

        // returns true if a datetime is future
        isFuture: function (datetime) {
            return Strolch.isFuture(datetime);
        },

        // turns hours into milliseconds
        hToMs: function (hour) {
            return Strolch.hToMs(hour);
        },

        // turns milliseconds into hours
        msToH: function (milliseconds) {
            return Strolch.msToH(milliseconds);
        },

        getCookie: function (cname) {
            return Strolch.getCookie(cname);
        },
        setCookie: function (cname, cvalue, expiration) {
            Strolch.setCookie(cname, cvalue, expiration);
        },
        deleteCookie: function (cname) {
            Strolch.deleteCookie(cname);
        },

        // fires an event that will change the page of the app
        changePage: function (page, keepQueryParams) {
            if (typeof keepQueryParams !== 'boolean')
                keepQueryParams = false;

            this.fire("cx-page-change", {
                page: page,
                keepQueryParams: keepQueryParams
            });
        },

        // convenience function to get the error message from responses
        onRequestError: function (event) {
            var readyState = event.detail.request.xhr.readyState;
            var status = event.detail.request.xhr.status;

            if (readyState === 4 && status === 0) {
                this.fire("cx-server-not-available", event);
            } else if (status === 401) {
                this.fire("cx-session-invalid", event);
            } else if (status === 403) {
                this.fire("cx-privilege-denied", event);
            } else {
                this.requestErrorToMsg(event);
            }
        },

        requestEventToUrl: function (event) {
            return event.detail.detail.request.url;
        },

        requestErrorToMsg: function (event) {

            var response;
            if (event.detail.request)
                response = event.detail.request.xhr.response;
            else
                response = event.detail.detail.error.message;

            var msg;
            var isError = false;

            if (response && response.state) {
                isError = response.state === "EXCEPTION";
            }

            if (response && response.i18n) {
                var args = [response.i18n.key];
                if (response.i18n.values != null) {
                    Object.keys(response.i18n.values).forEach(function (key) {
                        args.push(key);
                        args.push(response.i18n.values[key]);
                    });
                }
                msg = this.localize.apply(this, args);
            } else {

                if (response && response.msg) {
                    msg = response.msg;
                } else if (typeof (response) === 'string') {
                    if (response.trim().charAt(0) === '{') {
                        var json = JSON.parse(response);

                        if (json && json.i18n) {
                            var args = [json.i18n.key];
                            if (json.i18n.values != null) {
                                Object.keys(json.i18n.values).forEach(function (key) {
                                    args.push(key);
                                    args.push(json.i18n.values[key]);
                                });
                            }
                            msg = this.localize.apply(this, args);
                        } else if (json.msg) {
                            msg = json.msg;
                        } else {
                            msg = response;
                        }
                    } else {
                        msg = response;
                    }
                } else if (event.detail && event.detail.error && event.detail.error.message && event.detail.request && event.detail.request.url) {
                    msg = event.detail.error.message + ": " + event.detail.request.url;
                } else if (event.detail && event.detail.error && event.detail.error.message) {
                    msg = event.detail.error.message;
                } else {
                    console.error("Missing error message on request error", event);
                    msg = "Request Failed and no message available!";
                }
            }

            this.showDialog(msg, isError);
        },

        // fires an event that will show a dialog
        showDialog: function (message, isError) {
            this.fire("cx-show-dialog", {
                message: message,
                isError: isError
            });
        },
        // fires an event that will show a dialog
        showDialogTitle: function (title, message) {
            this.fire("cx-show-dialog", {
                title: title,
                message: message
            });
        },

        // fires an event that will show an information dialog, with optional callback
        showInfo: function (data) {
            if (data.callback != null)
                data.callback.bind(this);
            this.fire("cx-show-info", data);
        },

        // fires an event that will show a notification below the toolbar
        showNotification: function (id, message, faIcon, action1, callback1, action2, callback2, action3, callback3) {
            this.fire("cx-show-notification", {
                id: id,
                message: message,
                faIcon: faIcon,
                action1: action1,
                callback1: callback1,
                action2: action2,
                callback2: callback2,
                action3: action3,
                callback3: callback3,
                bind: this
            });
        },
        clearNotification: function (id) {
            this.fire("cx-clear-notification", {
                id: id
            });
        },

        showError: function (title, text) {
            this.showDialogTitle(title, text, true);
        },

        showToast: function (text) {
            this.fire('cx-show-toast', {text: text});
        },

        localizeJsonMsg: function (jsonMsg) {
            if (jsonMsg === null)
                return jsonMsg;

            this.localize.useKeyIfMissing = true;

            try {
                if (jsonMsg.values === null || Object.keys(jsonMsg.values).length === 0)
                    return this.localize(jsonMsg.key);

                var values = [jsonMsg.key];
                var keys = Object.keys(jsonMsg.values);
                for (var i = 0; i < keys.length; i++) {
                    var key = keys[i];
                    values.push(key);
                    values.push(jsonMsg.values[key]);
                }
                return this.localize.apply(this.localize, values);
            } catch (e) {
                console.log(e);
                return jsonMsg.key;
            }
        }
    };
</script>